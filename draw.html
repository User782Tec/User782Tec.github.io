<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Touch模块测试</title>
        <style>
            canvas {
                position: absolute;
                left: 0px;
                top: 0px;
                touch-action: none;
            }
            dialog {
                position: absolute;
            }
            input[type=number] {
                width: 3em;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" onclick="toggleMenu()"></canvas>
        <dialog id="menu">
            颜色 <input type="color" id="color">
            笔刷粗细 <input type="number" id="width" value="2">
            启用压感 <input type="checkbox" id="force" checked="checked">
            工具 
            <select id="tools">
                <option>画笔</option>
                <option value="rgba(0,0,0,0)">橡皮</option>
            </select>
        </dialog>
        <script>
            var c = document.getElementById("canvas");
            var ctx = c.getContext('2d');
            var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
            var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
            c.width = w;
            c.height = h;
            function toggleMenu() {
                if (document.getElementById("menu").open) {
                    document.getElementById("menu").open = false;
                }
                else {
                    document.getElementById("menu").open = "open";
                }
            }
            c.addEventListener("touchstart",(e) => {
                ctx.lineWidth = document.getElementById("width").value;
                ctx.strokeStyle = document.getElementById("color").value;
                if (!document.getElementById("tools").value) {
                    ctx.strokeStyle = document.getElementById("tools").value;
                    console.log(ctx.strokeStyle);
                }
                ctx.beginPath();
                ctx.moveTo(e.touches[0].pageX,e.touches[0].pageY);
            });
            c.addEventListener("touchmove",(e) => {
                if (document.getElementById("force").checked && e.touches[0].force != 0) {
                    ctx.lineWidth = document.getElementById("width") * e.touches[0].force;
                }
                ctx.lineTo(e.touches[0].pageX,e.touches[0].pageY);
                ctx.stroke();
                //console.log("触摸坐标：",e.touches[0].clientX,e.touches[0].clientY,"压感：",e.touches[0].force);
            });
            c.addEventListener("touchend",(e) => {
                ctx.stroke();
            });
        </script>
    </body>
</html>